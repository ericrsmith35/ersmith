<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <assignments>
        <name>Clear_Case_Comment</name>
        <label>Clear Case Comment</label>
        <locationX>860</locationX>
        <locationY>486</locationY>
        <assignmentItems>
            <assignToReference>objCaseComment</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>objCaseCommentEmpty</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>For_All_Comments</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Do_Nothing</name>
        <label>Do Nothing</label>
        <locationX>21</locationX>
        <locationY>27</locationY>
        <assignmentItems>
            <assignToReference>vCommentId</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>0D70e000005vSx4CAE</stringValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Get_Comment</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Save_Case_Comment</name>
        <label>Save Case Comment</label>
        <locationX>857</locationX>
        <locationY>363</locationY>
        <assignmentItems>
            <assignToReference>colCaseComment</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>objCaseComment</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Clear_Case_Comment</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Save_Feed_Id</name>
        <label>Save Feed Id</label>
        <locationX>143</locationX>
        <locationY>255</locationY>
        <assignmentItems>
            <assignToReference>vFeedId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>objFeedComment.FeedItemId</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Get_Queue_Id</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Set_Case_Comment_Fields</name>
        <label>Set Case Comment Fields</label>
        <locationX>1042</locationX>
        <locationY>361</locationY>
        <assignmentItems>
            <assignToReference>objCaseComment.CommentBody</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>fCaseCommentBody</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>objCaseComment.CreatedById</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>objFeedComment2.CreatedById</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>objCaseComment.CreatedDate</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>objFeedComment2.CreatedDate</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>objCaseComment.ParentId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>vCaseId</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Save_Case_Comment</targetReference>
        </connector>
    </assignments>
    <decisions>
        <name>Ticket_Requested</name>
        <label>Ticket Requested?</label>
        <locationX>357</locationX>
        <locationY>27</locationY>
        <defaultConnectorLabel>[Default Outcome]</defaultConnectorLabel>
        <rules>
            <name>YES</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>objFeedComment.CommentBody</leftValueReference>
                <operator>Contains</operator>
                <rightValue>
                    <stringValue>#ticket</stringValue>
                </rightValue>
            </conditions>
            <label>YES</label>
        </rules>
    </decisions>
    <description>If #ticket is mentioned in a comment then create a Case
Flow is called from Trigger: FeedCommentTrigger</description>
    <formulas>
        <name>fCaseCommentBody</name>
        <dataType>String</dataType>
        <expression>{!objFeedComment2.CommentBody} &amp; fCrLf &amp;
&quot;Original Comment By: &quot; &amp; {!vUserName} &amp; &quot; On: &quot; &amp; TEXT({!objFeedComment2.CreatedDate})</expression>
    </formulas>
    <formulas>
        <name>fCaseDescription</name>
        <dataType>String</dataType>
        <expression>SUBSTITUTE(SUBSTITUTE({!vItemBody},&quot;&lt;p&gt;&quot;,&quot;&quot;),&quot;&lt;/p&gt;&quot;,&quot;&quot;) &amp; {!fCrLf} &amp; 
IF(ISBLANK({!vItemLinkUrl}),&quot;&quot;,&quot;[&quot; &amp; {!vItemLinkUrl} &amp; &quot;]&quot; &amp; fCrLf) &amp;
&quot;Created By: &quot; &amp; {!vUserName} &amp; &quot; On: &quot; &amp; {!vItemCreatedDate}</expression>
    </formulas>
    <formulas>
        <name>fCrLf</name>
        <dataType>String</dataType>
        <expression>SUBSTITUTE(ttCrLf,&quot;&#39;&quot;,&quot;&quot;)</expression>
    </formulas>
    <formulas>
        <name>fSubject</name>
        <dataType>String</dataType>
        <expression>&quot;Created From Chatter Post&quot; &amp; 
IF(ISBLANK({!vItemTitle}),&quot;&quot;,&quot; - &quot; &amp; {!vItemTitle})</expression>
    </formulas>
    <formulas>
        <name>fUserId</name>
        <dataType>String</dataType>
        <expression>{!$User.Id}</expression>
    </formulas>
    <interviewLabel>Chatter - Feed Comment - Create Ticket {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Chatter - Feed Comment - Create Ticket</label>
    <loops>
        <name>For_All_Comments</name>
        <label>For All Comments</label>
        <locationX>665</locationX>
        <locationY>246</locationY>
        <assignNextValueToReference>objFeedComment2</assignNextValueToReference>
        <collectionReference>colFeedComment</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Get_Creator_Name_0</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Write_Case_Comments</targetReference>
        </noMoreValuesConnector>
    </loops>
    <processType>AutoLaunchedFlow</processType>
    <recordCreates>
        <name>Add_Case_to_Chatter_Feed</name>
        <label>Add Case # to Chatter Feed</label>
        <locationX>1035</locationX>
        <locationY>133</locationY>
        <inputAssignments>
            <field>CommentBody</field>
            <value>
                <elementReference>ttNewCaseCreated</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>CommentType</field>
            <value>
                <stringValue>TextComment</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>FeedItemId</field>
            <value>
                <elementReference>vFeedId</elementReference>
            </value>
        </inputAssignments>
        <object>FeedComment</object>
    </recordCreates>
    <recordCreates>
        <name>Create_Case</name>
        <label>Create Case</label>
        <locationX>668</locationX>
        <locationY>484</locationY>
        <assignRecordIdToReference>vCaseId</assignRecordIdToReference>
        <connector>
            <targetReference>Get_All_Comments</targetReference>
        </connector>
        <inputAssignments>
            <field>ContactId</field>
            <value>
                <elementReference>vItemContactID</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Description</field>
            <value>
                <elementReference>fCaseDescription</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Origin</field>
            <value>
                <stringValue>Agent</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>OwnerId</field>
            <value>
                <elementReference>vSDQueue</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Platform__c</field>
            <value>
                <stringValue>Salesforce</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Priority</field>
            <value>
                <stringValue>7+: When Feasible</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>RecordTypeId</field>
            <value>
                <elementReference>vRecordTypeId</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Status</field>
            <value>
                <stringValue>New</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Subject</field>
            <value>
                <elementReference>fSubject</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Type</field>
            <value>
                <stringValue>Other</stringValue>
            </value>
        </inputAssignments>
        <object>Case</object>
    </recordCreates>
    <recordCreates>
        <name>Write_Case_Comments</name>
        <label>Write Case Comments</label>
        <locationX>665</locationX>
        <locationY>136</locationY>
        <connector>
            <targetReference>Get_Case_Info</targetReference>
        </connector>
        <inputReference>colCaseComment</inputReference>
    </recordCreates>
    <recordLookups>
        <name>Get_All_Comments</name>
        <label>Get All Comments</label>
        <locationX>667</locationX>
        <locationY>362</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>For_All_Comments</targetReference>
        </connector>
        <filters>
            <field>FeedItemId</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>objFeedComment.FeedItemId</elementReference>
            </value>
        </filters>
        <filters>
            <field>IsDeleted</field>
            <operator>EqualTo</operator>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </filters>
        <object>FeedComment</object>
        <outputReference>colFeedComment</outputReference>
        <queriedFields>CommentBody</queriedFields>
        <queriedFields>CreatedById</queriedFields>
        <queriedFields>CreatedDate</queriedFields>
        <sortField>CreatedDate</sortField>
        <sortOrder>Asc</sortOrder>
    </recordLookups>
    <recordLookups>
        <name>Get_Case_Info</name>
        <label>Get Case Info</label>
        <locationX>851</locationX>
        <locationY>136</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Add_Case_to_Chatter_Feed</targetReference>
        </connector>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>vCaseId</elementReference>
            </value>
        </filters>
        <object>Case</object>
        <outputAssignments>
            <assignToReference>vCaseNumber</assignToReference>
            <field>CaseNumber</field>
        </outputAssignments>
    </recordLookups>
    <recordLookups>
        <name>Get_Comment</name>
        <label>Get Comment</label>
        <locationX>140</locationX>
        <locationY>142</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Save_Feed_Id</targetReference>
        </connector>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>vCommentId</elementReference>
            </value>
        </filters>
        <object>FeedComment</object>
        <outputReference>objFeedComment</outputReference>
        <queriedFields>CommentBody</queriedFields>
        <queriedFields>CommentType</queriedFields>
        <queriedFields>CreatedById</queriedFields>
        <queriedFields>FeedItemId</queriedFields>
    </recordLookups>
    <recordLookups>
        <name>Get_Creator_Name</name>
        <label>Get Creator Name</label>
        <locationX>486</locationX>
        <locationY>488</locationY>
        <assignNullValuesIfNoRecordsFound>true</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Get_User_s_Contact_ID</targetReference>
        </connector>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>vItemCreatedBy</elementReference>
            </value>
        </filters>
        <object>User</object>
        <outputAssignments>
            <assignToReference>vUserName</assignToReference>
            <field>Name</field>
        </outputAssignments>
    </recordLookups>
    <recordLookups>
        <name>Get_Creator_Name_0</name>
        <label>Get Creator Name</label>
        <locationX>1041</locationX>
        <locationY>246</locationY>
        <assignNullValuesIfNoRecordsFound>true</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Set_Case_Comment_Fields</targetReference>
        </connector>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>objFeedComment2.CreatedById</elementReference>
            </value>
        </filters>
        <object>User</object>
        <outputAssignments>
            <assignToReference>vUserName</assignToReference>
            <field>Name</field>
        </outputAssignments>
    </recordLookups>
    <recordLookups>
        <name>Get_Parent</name>
        <label>Get Parent</label>
        <locationX>143</locationX>
        <locationY>486</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Get_RecordTypeId</targetReference>
        </connector>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>vFeedId</elementReference>
            </value>
        </filters>
        <object>FeedItem</object>
        <outputAssignments>
            <assignToReference>vItemBody</assignToReference>
            <field>Body</field>
        </outputAssignments>
        <outputAssignments>
            <assignToReference>vItemCreatedBy</assignToReference>
            <field>CreatedById</field>
        </outputAssignments>
        <outputAssignments>
            <assignToReference>vItemCreatedDate</assignToReference>
            <field>CreatedDate</field>
        </outputAssignments>
        <outputAssignments>
            <assignToReference>vItemHasLink</assignToReference>
            <field>HasLink</field>
        </outputAssignments>
        <outputAssignments>
            <assignToReference>vItemLinkUrl</assignToReference>
            <field>LinkUrl</field>
        </outputAssignments>
        <outputAssignments>
            <assignToReference>vItemTitle</assignToReference>
            <field>Title</field>
        </outputAssignments>
    </recordLookups>
    <recordLookups>
        <name>Get_Queue_Id</name>
        <label>Get Queue Id</label>
        <locationX>139</locationX>
        <locationY>374</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Get_Parent</targetReference>
        </connector>
        <filters>
            <field>Label</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Production</stringValue>
            </value>
        </filters>
        <object>Record_IDs__mdt</object>
        <outputAssignments>
            <assignToReference>vSDQueue</assignToReference>
            <field>Case_SD_Work_Order_Queue__c</field>
        </outputAssignments>
    </recordLookups>
    <recordLookups>
        <name>Get_RecordTypeId</name>
        <label>Get RecordTypeId</label>
        <locationX>320</locationX>
        <locationY>491</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Get_Creator_Name</targetReference>
        </connector>
        <filters>
            <field>Name</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Software Development</stringValue>
            </value>
        </filters>
        <filters>
            <field>SobjectType</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Case</stringValue>
            </value>
        </filters>
        <object>RecordType</object>
        <outputAssignments>
            <assignToReference>vRecordTypeId</assignToReference>
            <field>Id</field>
        </outputAssignments>
    </recordLookups>
    <recordLookups>
        <name>Get_User_s_Contact_ID</name>
        <label>Get User&#39;s Contact ID</label>
        <locationX>489</locationX>
        <locationY>608</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Create_Case</targetReference>
        </connector>
        <filters>
            <field>User__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>vItemCreatedBy</elementReference>
            </value>
        </filters>
        <object>Contact</object>
        <outputAssignments>
            <assignToReference>vItemContactID</assignToReference>
            <field>Id</field>
        </outputAssignments>
    </recordLookups>
    <startElementReference>Get_Comment</startElementReference>
    <status>Active</status>
    <textTemplates>
        <name>ttCrLf</name>
        <text>&#39;
&#39;</text>
    </textTemplates>
    <textTemplates>
        <name>ttNewCaseCreated</name>
        <text>New Case Created: {!vCaseNumber}
https://gwi.my.salesforce.com/{!vCaseId}</text>
    </textTemplates>
    <variables>
        <name>colCaseComment</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>CaseComment</objectType>
    </variables>
    <variables>
        <name>colFeedComment</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>FeedComment</objectType>
    </variables>
    <variables>
        <name>objCaseComment</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>CaseComment</objectType>
    </variables>
    <variables>
        <name>objCaseCommentEmpty</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>CaseComment</objectType>
    </variables>
    <variables>
        <name>objFeedComment</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>FeedComment</objectType>
    </variables>
    <variables>
        <name>objFeedComment2</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>FeedComment</objectType>
    </variables>
    <variables>
        <name>vCaseId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>vCaseNumber</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>vCommentId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>vFeedId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>vItemBody</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>vItemContactID</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>vItemCreatedBy</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>vItemCreatedDate</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>vItemHasLink</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>vItemLinkUrl</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>vItemTitle</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>vRecordTypeId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>vSDQueue</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>vUserName</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
</Flow>

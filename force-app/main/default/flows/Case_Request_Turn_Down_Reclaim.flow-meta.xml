<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <assignments>
        <name>Create_CaseAsset</name>
        <label>Create CaseAsset</label>
        <locationX>1066</locationX>
        <locationY>216</locationY>
        <assignmentItems>
            <assignToReference>objCaseAsset.Asset__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>objAsset.Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>objCaseAsset.Case__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>vCaseID</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Save_CaseAsset</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Do_Nothing</name>
        <label>Do Nothing</label>
        <locationX>15</locationX>
        <locationY>9</locationY>
        <assignmentItems>
            <assignToReference>vOppID</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>006W000000CNGkd</stringValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Get_Opportunity</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Save_CaseAsset</name>
        <label>Save CaseAsset</label>
        <locationX>1062</locationX>
        <locationY>103</locationY>
        <assignmentItems>
            <assignToReference>colCaseAsset</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>objCaseAsset</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Process_Assets</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Save_Selection</name>
        <label>Save Selection</label>
        <locationX>864</locationX>
        <locationY>464</locationY>
        <assignmentItems>
            <assignToReference>selAssets</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>objAsset</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Check_for_Selected</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Select_All_0</name>
        <label>Select All</label>
        <locationX>674</locationX>
        <locationY>216</locationY>
        <assignmentItems>
            <assignToReference>selAssets</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>colAssets</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Process_Assets</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Set_ID</name>
        <label>Set IDs</label>
        <locationX>343</locationX>
        <locationY>308</locationY>
        <assignmentItems>
            <assignToReference>vQueueID</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>vNSEQueue</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Create_Case</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Set_ID_0</name>
        <label>Set IDs</label>
        <locationX>341</locationX>
        <locationY>216</locationY>
        <assignmentItems>
            <assignToReference>vQueueID</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>vSupportQueue</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Create_Case</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Set_ID_0_0</name>
        <label>Set IDs</label>
        <locationX>342</locationX>
        <locationY>514</locationY>
        <assignmentItems>
            <assignToReference>vQueueID</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>fSelf</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Create_Case</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Set_ID_1</name>
        <label>Set IDs</label>
        <locationX>340</locationX>
        <locationY>407</locationY>
        <assignmentItems>
            <assignToReference>vQueueID</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>vFieldQueue</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Create_Case</targetReference>
        </connector>
    </assignments>
    <choices>
        <name>Field</name>
        <choiceText>Field</choiceText>
        <dataType>String</dataType>
        <value>
            <stringValue>Field</stringValue>
        </value>
    </choices>
    <choices>
        <name>Hold_Assign_Case_to_Self</name>
        <choiceText>Hold (Assign Case to Self)</choiceText>
        <dataType>String</dataType>
        <value>
            <stringValue>Hold</stringValue>
        </value>
    </choices>
    <choices>
        <name>NSE</name>
        <choiceText>NSE</choiceText>
        <dataType>String</dataType>
        <value>
            <stringValue>NSE</stringValue>
        </value>
    </choices>
    <choices>
        <name>Support</name>
        <choiceText>Support</choiceText>
        <dataType>String</dataType>
        <value>
            <stringValue>Support</stringValue>
        </value>
    </choices>
    <decisions>
        <name>Queue_Name</name>
        <label>Queue Name</label>
        <locationX>156</locationX>
        <locationY>348</locationY>
        <defaultConnectorLabel>[Default Outcome]</defaultConnectorLabel>
        <rules>
            <name>SUPPORT1</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Department</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <elementReference>Support</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Set_ID_0</targetReference>
            </connector>
            <label>SUPPORT</label>
        </rules>
        <rules>
            <name>NSE1</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Department</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <elementReference>Field</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Set_ID</targetReference>
            </connector>
            <label>NSE</label>
        </rules>
        <rules>
            <name>SELF</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Department</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <elementReference>Hold_Assign_Case_to_Self</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Set_ID_0_0</targetReference>
            </connector>
            <label>SELF</label>
        </rules>
        <rules>
            <name>FIELD1</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Department</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <elementReference>Field</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Set_ID_1</targetReference>
            </connector>
            <label>FIELD</label>
        </rules>
    </decisions>
    <decisions>
        <name>Select_All0</name>
        <label>Select All?</label>
        <locationX>681</locationX>
        <locationY>352</locationY>
        <defaultConnector>
            <targetReference>Check_for_Selected</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>PARTIAL</defaultConnectorLabel>
        <rules>
            <name>ALL</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>SELECT_ALL</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Select_All_0</targetReference>
            </connector>
            <label>ALL</label>
        </rules>
    </decisions>
    <decisions>
        <name>Selected0</name>
        <label>Selected?</label>
        <locationX>1072</locationX>
        <locationY>350</locationY>
        <defaultConnector>
            <targetReference>Check_for_Selected</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>NO</defaultConnectorLabel>
        <rules>
            <name>SELECTED00</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Asset_Selection</leftValueReference>
                <operator>Contains</operator>
                <rightValue>
                    <elementReference>objAsset.Id</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Save_Selection</targetReference>
            </connector>
            <label>SELECTED</label>
        </rules>
    </decisions>
    <description>Select Assets from a disconnect Opportunity and create a Case for Support or NSE to handle the turn-down and equipment recla
mation</description>
    <dynamicChoiceSets>
        <name>Assets</name>
        <dataType>String</dataType>
        <displayField>Display__c</displayField>
        <filters>
            <field>Disconnect_Opportunity__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>vOppID</elementReference>
            </value>
        </filters>
        <object>Asset</object>
        <sortField>Status</sortField>
        <sortOrder>Asc</sortOrder>
        <valueField>Id</valueField>
    </dynamicChoiceSets>
    <formulas>
        <name>fSelf</name>
        <dataType>String</dataType>
        <expression>{!$User.Id}</expression>
    </formulas>
    <interviewLabel>Case - Request Turn-Down / Reclaim {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Case - Request Turn-Down / Reclaim</label>
    <loops>
        <name>Check_for_Selected</name>
        <label>Check for Selected</label>
        <locationX>862</locationX>
        <locationY>352</locationY>
        <assignNextValueToReference>objAsset</assignNextValueToReference>
        <collectionReference>colAssets</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Selected0</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Process_Assets</targetReference>
        </noMoreValuesConnector>
    </loops>
    <loops>
        <name>Process_Assets</name>
        <label>Process Assets</label>
        <locationX>854</locationX>
        <locationY>216</locationY>
        <assignNextValueToReference>objAsset</assignNextValueToReference>
        <collectionReference>selAssets</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Create_CaseAsset</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Save_CaseAssets</targetReference>
        </noMoreValuesConnector>
    </loops>
    <processType>Flow</processType>
    <recordCreates>
        <name>Create_Case</name>
        <label>Create Case</label>
        <locationX>510</locationX>
        <locationY>354</locationY>
        <assignRecordIdToReference>vCaseID</assignRecordIdToReference>
        <connector>
            <targetReference>Select_All0</targetReference>
        </connector>
        <inputAssignments>
            <field>AccountId</field>
            <value>
                <elementReference>objOpp.Primary_Dlvr_To_Acct__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>ContactId</field>
            <value>
                <elementReference>objOpp.WFR_Delivery_Contact__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Description</field>
            <value>
                <elementReference>Description</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Opportunity__c</field>
            <value>
                <elementReference>vOppID</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Origin</field>
            <value>
                <stringValue>Agent</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>OwnerId</field>
            <value>
                <elementReference>vQueueID</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Provision_Date_Request__c</field>
            <value>
                <elementReference>Due_Date</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>RecordTypeId</field>
            <value>
                <elementReference>vRecTypeID</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Service_Address__c</field>
            <value>
                <elementReference>objOpp.Primary_Service_Address__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Service_Catagory__c</field>
            <value>
                <stringValue>Turn-Down Request</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Status</field>
            <value>
                <stringValue>New</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Subject</field>
            <value>
                <elementReference>Subject</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Work_Order_Queue__c</field>
            <value>
                <elementReference>Department</elementReference>
            </value>
        </inputAssignments>
        <object>Case</object>
    </recordCreates>
    <recordCreates>
        <name>Save_CaseAssets</name>
        <label>Save CaseAssets</label>
        <locationX>855</locationX>
        <locationY>103</locationY>
        <inputReference>colCaseAsset</inputReference>
    </recordCreates>
    <recordLookups>
        <name>Available_Assets</name>
        <label>Available Assets</label>
        <locationX>484</locationX>
        <locationY>105</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Turn_Down_Request</targetReference>
        </connector>
        <filters>
            <field>Disconnect_Opportunity__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>vOppID</elementReference>
            </value>
        </filters>
        <object>Asset</object>
        <outputReference>colAssets</outputReference>
        <queriedFields>Id</queriedFields>
    </recordLookups>
    <recordLookups>
        <name>Get_Opportunity</name>
        <label>Get Opportunity</label>
        <locationX>154</locationX>
        <locationY>104</locationY>
        <assignNullValuesIfNoRecordsFound>true</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Get_Queue_IDs</targetReference>
        </connector>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>vOppID</elementReference>
            </value>
        </filters>
        <object>Opportunity</object>
        <outputReference>objOpp</outputReference>
        <queriedFields>AccountId</queriedFields>
        <queriedFields>Name</queriedFields>
        <queriedFields>Type</queriedFields>
        <queriedFields>WFR_Delivery_Contact__c</queriedFields>
        <queriedFields>Primary_Service_Address__c</queriedFields>
        <queriedFields>Primary_Dlvr_To_Acct__c</queriedFields>
    </recordLookups>
    <recordLookups>
        <name>Get_Queue_IDs</name>
        <label>Get Queue IDs</label>
        <locationX>319</locationX>
        <locationY>104</locationY>
        <assignNullValuesIfNoRecordsFound>true</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Available_Assets</targetReference>
        </connector>
        <filters>
            <field>DeveloperName</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Master</stringValue>
            </value>
        </filters>
        <object>Record_IDs__mdt</object>
        <outputAssignments>
            <assignToReference>vFieldQueue</assignToReference>
            <field>Case_Field_Work_Order_Queue__c</field>
        </outputAssignments>
        <outputAssignments>
            <assignToReference>vNSEQueue</assignToReference>
            <field>Case_NSE_Work_Order_Queue__c</field>
        </outputAssignments>
        <outputAssignments>
            <assignToReference>vSupportQueue</assignToReference>
            <field>Case_Support_Work_Order_Queue__c</field>
        </outputAssignments>
        <outputAssignments>
            <assignToReference>vRecTypeID</assignToReference>
            <field>Case_Support_Work_Order_Record_Type__c</field>
        </outputAssignments>
    </recordLookups>
    <screens>
        <name>Turn_Down_Request</name>
        <label>Turn-Down Request</label>
        <locationX>155</locationX>
        <locationY>216</locationY>
        <allowBack>true</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>true</allowPause>
        <connector>
            <targetReference>Queue_Name</targetReference>
        </connector>
        <fields>
            <name>Department</name>
            <choiceReferences>Support</choiceReferences>
            <choiceReferences>Field</choiceReferences>
            <choiceReferences>NSE</choiceReferences>
            <choiceReferences>Hold_Assign_Case_to_Self</choiceReferences>
            <dataType>String</dataType>
            <defaultSelectedChoiceReference>Support</defaultSelectedChoiceReference>
            <fieldText>Department</fieldText>
            <fieldType>RadioButtons</fieldType>
            <isRequired>true</isRequired>
        </fields>
        <fields>
            <name>Subject</name>
            <dataType>String</dataType>
            <defaultValue>
                <elementReference>ttCaseSubject</elementReference>
            </defaultValue>
            <fieldText>Subject</fieldText>
            <fieldType>InputField</fieldType>
            <isRequired>true</isRequired>
        </fields>
        <fields>
            <name>Due_Date</name>
            <dataType>Date</dataType>
            <fieldText>Due Date</fieldText>
            <fieldType>InputField</fieldType>
            <isRequired>true</isRequired>
        </fields>
        <fields>
            <name>Description</name>
            <fieldText>Description</fieldText>
            <fieldType>LargeTextArea</fieldType>
            <isRequired>true</isRequired>
        </fields>
        <fields>
            <name>Asset_Selection</name>
            <choiceReferences>Assets</choiceReferences>
            <dataType>String</dataType>
            <fieldText>Asset Selection</fieldText>
            <fieldType>MultiSelectCheckboxes</fieldType>
            <isRequired>false</isRequired>
        </fields>
        <fields>
            <name>SELECT_ALL</name>
            <dataType>Boolean</dataType>
            <fieldText>SELECT ALL</fieldText>
            <fieldType>InputField</fieldType>
            <isRequired>true</isRequired>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <startElementReference>Get_Opportunity</startElementReference>
    <status>Active</status>
    <textTemplates>
        <name>ttCaseSubject</name>
        <text>Turn-Down Ticket to {!Department} for: {!objOpp.Name}</text>
    </textTemplates>
    <variables>
        <name>colAssets</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Asset</objectType>
    </variables>
    <variables>
        <name>colCaseAsset</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>CaseAsset__c</objectType>
    </variables>
    <variables>
        <name>colRecType</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>RecordType</objectType>
    </variables>
    <variables>
        <name>objAsset</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Asset</objectType>
    </variables>
    <variables>
        <name>objCase</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Case</objectType>
    </variables>
    <variables>
        <name>objCaseAsset</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>CaseAsset__c</objectType>
    </variables>
    <variables>
        <name>objOpp</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Opportunity</objectType>
    </variables>
    <variables>
        <name>objRecType</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>RecordType</objectType>
    </variables>
    <variables>
        <name>selAssets</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Asset</objectType>
    </variables>
    <variables>
        <name>vCaseID</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>vFieldQueue</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>vNSEQueue</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>vOppID</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>vQueueID</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>vRecTypeID</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>vSupportQueue</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
</Flow>

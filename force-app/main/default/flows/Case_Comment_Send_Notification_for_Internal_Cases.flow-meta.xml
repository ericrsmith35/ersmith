<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <actionCalls>
        <name>Send_Email</name>
        <label>Send Email</label>
        <locationX>1108</locationX>
        <locationY>484</locationY>
        <actionName>emailSimple</actionName>
        <actionType>emailSimple</actionType>
        <inputParameters>
            <name>emailBody</name>
            <value>
                <elementReference>ttbody1</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>emailSubject</name>
            <value>
                <elementReference>ttSubject</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>senderType</name>
            <value>
                <stringValue>OrgWideEmailAddress</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>senderAddress</name>
            <value>
                <elementReference>fSenderAddress</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>emailAddresses</name>
            <value>
                <elementReference>vSendToEmails</elementReference>
            </value>
        </inputParameters>
    </actionCalls>
    <assignments>
        <name>Append_Email_Address</name>
        <label>Append Email Address</label>
        <locationX>1016</locationX>
        <locationY>612</locationY>
        <assignmentItems>
            <assignToReference>vSendToEmails</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>fNewEmail</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>For_Each_Team_Member</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Do_Nothing</name>
        <label>Do Nothing</label>
        <locationX>21</locationX>
        <locationY>22</locationY>
        <assignmentItems>
            <assignToReference>vCaseId1</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>5000e00001LO2fAAAT</stringValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Get_Case_IDs</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Send_To_Email_Addressses</name>
        <label>Send To Email Addressses</label>
        <locationX>527</locationX>
        <locationY>485</locationY>
        <assignmentItems>
            <assignToReference>vSendToEmails</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>fEmailAddresses</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Get_Case_Team_Members</targetReference>
        </connector>
    </assignments>
    <decisions>
        <name>Found_Comment_User</name>
        <label>Found Comment User?</label>
        <locationX>523</locationX>
        <locationY>368</locationY>
        <defaultConnectorLabel>[Default Outcome]</defaultConnectorLabel>
        <rules>
            <name>FOUND</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>objCommentUser</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Get_Record_Types</targetReference>
            </connector>
            <label>FOUND</label>
        </rules>
    </decisions>
    <description>6/29/18 - ers - Pull in Case Team member email addresses</description>
    <formulas>
        <name>fBothEmails</name>
        <dataType>String</dataType>
        <expression>{!objCaseOwnerUser.Email} &amp; &quot;, &quot; &amp;  {!objContacttoUser.Email}</expression>
    </formulas>
    <formulas>
        <name>fCaseid15</name>
        <dataType>String</dataType>
        <expression>LEFT({!vCaseId1}, 15)</expression>
    </formulas>
    <formulas>
        <name>fCaseThread</name>
        <dataType>String</dataType>
        <expression>&quot;[ref:_&quot; &amp; LEFT({!$Organization.Id},5) &amp; SUBSTITUTE(RIGHT({!$Organization.Id},11), &quot;0&quot;, &quot;&quot; )&amp; &quot;._&quot; &amp; LEFT({!fCaseid15},5) &amp; SUBSTITUTE(Left(RIGHT({!fCaseid15},10), 5), &quot;0&quot;, &quot;&quot;) &amp; RIGHT({!fCaseid15},5) &amp; &quot;:ref]&quot;</expression>
    </formulas>
    <formulas>
        <name>fEmailAddresses</name>
        <dataType>String</dataType>
        <expression>IF({!ObjCaseComment.CreatedById} = {!objCase1.OwnerId}, {!objContacttoUser.Email},
IF ({!ObjCaseComment.CreatedById} = CASESAFEID({!objContact.User__c}), {!objCaseOwnerUser.Email},
{!fBothEmails}))</expression>
    </formulas>
    <formulas>
        <name>fGWI</name>
        <dataType>String</dataType>
        <expression>{!$Label.GWI_Salesforce_Domain}</expression>
    </formulas>
    <formulas>
        <name>fNewEmail</name>
        <dataType>String</dataType>
        <expression>&quot;,&quot; &amp; {!vCTMemail}</expression>
    </formulas>
    <formulas>
        <name>fSenderAddress</name>
        <dataType>String</dataType>
        <expression>CASE({!objCaseRecordType.Name}, 
&quot;IT&quot;, &quot;it@gwisupport.net&quot;,
&quot;Software Development&quot;, &quot;sd@gwisupport.net&quot;, 
&quot;NE - Request&quot;, &quot;ne@gwisupport.net&quot;,
&quot;NE - Maintenance&quot;, &quot;ne2@gwisupport.net&quot;,
&quot;NE - Outage&quot;, &quot;ne1@gwisupport.net&quot;, &quot;&quot;)</expression>
    </formulas>
    <interviewLabel>Case Comment - Send Notification for Internal Cases {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Case Comment - Send Notification for Internal Cases</label>
    <loops>
        <name>For_Each_Team_Member</name>
        <label>For Each Team Member</label>
        <locationX>903</locationX>
        <locationY>484</locationY>
        <assignNextValueToReference>objCaseTeamMember</assignNextValueToReference>
        <collectionReference>colCaseTeamMember</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Get_Member_Record</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Send_Email</targetReference>
        </noMoreValuesConnector>
    </loops>
    <processType>AutoLaunchedFlow</processType>
    <recordLookups>
        <name>Get_Case_Comment_Id_s</name>
        <label>Get Case Comment Id&#39;s</label>
        <locationX>166</locationX>
        <locationY>364</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Get_User_Name</targetReference>
        </connector>
        <filters>
            <field>ParentId</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>vCaseId1</elementReference>
            </value>
        </filters>
        <object>CaseComment</object>
        <outputReference>ObjCaseComment</outputReference>
        <queriedFields>ParentId</queriedFields>
        <queriedFields>Id</queriedFields>
        <queriedFields>CreatedById</queriedFields>
        <queriedFields>CommentBody</queriedFields>
        <sortField>CreatedDate</sortField>
        <sortOrder>Desc</sortOrder>
    </recordLookups>
    <recordLookups>
        <name>Get_Case_IDs</name>
        <label>Get Case IDs</label>
        <locationX>164</locationX>
        <locationY>129</locationY>
        <assignNullValuesIfNoRecordsFound>true</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Get_User_Info_for_Owner</targetReference>
        </connector>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>vCaseId1</elementReference>
            </value>
        </filters>
        <object>Case</object>
        <outputReference>objCase1</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>Status</queriedFields>
        <queriedFields>RecordTypeId</queriedFields>
        <queriedFields>Work_Order_Queue__c</queriedFields>
        <queriedFields>ContactId</queriedFields>
        <queriedFields>OwnerId</queriedFields>
        <queriedFields>Subject</queriedFields>
        <queriedFields>CaseNumber</queriedFields>
    </recordLookups>
    <recordLookups>
        <name>Get_Case_Team_Members</name>
        <label>Get Case Team Members</label>
        <locationX>712</locationX>
        <locationY>485</locationY>
        <assignNullValuesIfNoRecordsFound>true</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>For_Each_Team_Member</targetReference>
        </connector>
        <filters>
            <field>ParentId</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>vCaseId1</elementReference>
            </value>
        </filters>
        <object>CaseTeamMember</object>
        <outputReference>colCaseTeamMember</outputReference>
        <queriedFields>MemberId</queriedFields>
    </recordLookups>
    <recordLookups>
        <name>Get_Contact_Id_s</name>
        <label>Get Contact Id&#39;s</label>
        <locationX>164</locationX>
        <locationY>242</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Get_User_Info_for_Contact</targetReference>
        </connector>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>objCase1.ContactId</elementReference>
            </value>
        </filters>
        <object>Contact</object>
        <outputReference>objContact</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>User__c</queriedFields>
    </recordLookups>
    <recordLookups>
        <name>Get_Member_Record</name>
        <label>Get Member Record</label>
        <locationX>806</locationX>
        <locationY>612</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Append_Email_Address</targetReference>
        </connector>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>objCaseTeamMember.MemberId</elementReference>
            </value>
        </filters>
        <object>User</object>
        <outputAssignments>
            <assignToReference>vCTMemail</assignToReference>
            <field>Email</field>
        </outputAssignments>
    </recordLookups>
    <recordLookups>
        <name>Get_Record_Types</name>
        <label>Get Record Types</label>
        <locationX>348</locationX>
        <locationY>482</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Send_To_Email_Addressses</targetReference>
        </connector>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>objCase1.RecordTypeId</elementReference>
            </value>
        </filters>
        <object>RecordType</object>
        <outputReference>objCaseRecordType</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>Name</queriedFields>
    </recordLookups>
    <recordLookups>
        <name>Get_User_Info_for_Contact</name>
        <label>Get User Info for Contact</label>
        <locationX>343</locationX>
        <locationY>242</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Get_Case_Comment_Id_s</targetReference>
        </connector>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>objContact.User__c</elementReference>
            </value>
        </filters>
        <object>User</object>
        <outputReference>objContacttoUser</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>Email</queriedFields>
    </recordLookups>
    <recordLookups>
        <name>Get_User_Info_for_Owner</name>
        <label>Get User Info for Owner</label>
        <locationX>341</locationX>
        <locationY>131</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Get_Contact_Id_s</targetReference>
        </connector>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>objCase1.OwnerId</elementReference>
            </value>
        </filters>
        <object>User</object>
        <outputReference>objCaseOwnerUser</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>Email</queriedFields>
    </recordLookups>
    <recordLookups>
        <name>Get_User_Name</name>
        <label>Get User Name</label>
        <locationX>345</locationX>
        <locationY>366</locationY>
        <assignNullValuesIfNoRecordsFound>true</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Found_Comment_User</targetReference>
        </connector>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>ObjCaseComment.CreatedById</elementReference>
            </value>
        </filters>
        <object>User</object>
        <outputReference>objCommentUser</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>Name</queriedFields>
    </recordLookups>
    <startElementReference>Get_Case_IDs</startElementReference>
    <status>Active</status>
    <textTemplates>
        <name>ttbody1</name>
        <text>A new case comment has been logged on Case#{!objCase1.CaseNumber} - {!objCase1.Subject}.

{!fGWI}{!vCaseId1}

See the case comment details below:
--------------------------------------------------------------------------------------------------
{!objCommentUser.Name} -

{!ObjCaseComment.CommentBody}


{!fCaseThread}</text>
    </textTemplates>
    <textTemplates>
        <name>ttSubject</name>
        <text>New Case Comment Notification. Case Number 
{!objCase1.CaseNumber}</text>
    </textTemplates>
    <variables>
        <name>colCaseTeamMember</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>CaseTeamMember</objectType>
    </variables>
    <variables>
        <name>objCase1</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <objectType>Case</objectType>
    </variables>
    <variables>
        <name>ObjCaseComment</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>CaseComment</objectType>
    </variables>
    <variables>
        <name>objCaseOwnerUser</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>User</objectType>
    </variables>
    <variables>
        <name>objCaseRecordType</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <objectType>RecordType</objectType>
    </variables>
    <variables>
        <name>objCaseTeamMember</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>CaseTeamMember</objectType>
    </variables>
    <variables>
        <name>objCommentUser</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <objectType>User</objectType>
    </variables>
    <variables>
        <name>objContact</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <objectType>Contact</objectType>
    </variables>
    <variables>
        <name>objContacttoUser</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <objectType>User</objectType>
    </variables>
    <variables>
        <name>vCaseComment1</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <name>vCaseId1</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <name>vCTMemail</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>vFieldQueue</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <name>vNSEQueue</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <name>VQueueId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <name>vRecordTypeID</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <name>vRecTypeID</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <name>vSendToEmails</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>vSupportQueue</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <name>vtest</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
</Flow>

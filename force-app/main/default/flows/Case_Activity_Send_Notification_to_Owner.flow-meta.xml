<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <actionCalls>
        <name>Send_email_Support</name>
        <label>Send email Support</label>
        <locationX>959</locationX>
        <locationY>536</locationY>
        <actionName>emailSimple</actionName>
        <actionType>emailSimple</actionType>
        <inputParameters>
            <name>emailBody</name>
            <value>
                <elementReference>ttBody</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>emailSubject</name>
            <value>
                <elementReference>ttSubject</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>senderType</name>
            <value>
                <stringValue>OrgWideEmailAddress</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>senderAddress</name>
            <value>
                <elementReference>fSenderAddress</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>emailAddresses</name>
            <value>
                <elementReference>vSendToEmails</elementReference>
            </value>
        </inputParameters>
    </actionCalls>
    <actionCalls>
        <name>Send_email_Support_0</name>
        <label>Send email Support</label>
        <locationX>482</locationX>
        <locationY>817</locationY>
        <actionName>emailSimple</actionName>
        <actionType>emailSimple</actionType>
        <inputParameters>
            <name>emailBody</name>
            <value>
                <elementReference>ttBody</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>emailSubject</name>
            <value>
                <elementReference>ttSubject</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>senderType</name>
            <value>
                <stringValue>OrgWideEmailAddress</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>senderAddress</name>
            <value>
                <elementReference>fSenderAddress</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>emailAddresses</name>
            <value>
                <elementReference>vSendToEmails</elementReference>
            </value>
        </inputParameters>
    </actionCalls>
    <assignments>
        <name>Append_Email_Address</name>
        <label>Append Email Address</label>
        <locationX>798</locationX>
        <locationY>604</locationY>
        <assignmentItems>
            <assignToReference>vSendToEmails</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>fNewEmail</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>For_Each_Team_Member</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Append_Email_Address_0</name>
        <label>Append Email Address</label>
        <locationX>364</locationX>
        <locationY>927</locationY>
        <assignmentItems>
            <assignToReference>vSendToEmails</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>fNewEmail1</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>For_Each_Team_Member_0</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Do_Nothing</name>
        <label>Do Nothing</label>
        <locationX>27</locationX>
        <locationY>21</locationY>
        <assignmentItems>
            <assignToReference>vCaseId1</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>5000e00001LO2fAAAT</stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>vTaskId</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>00T0e00006OtDZM</stringValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Get_Case_IDs</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Send_To_Email_Addresses</name>
        <label>Send To Email Addresses</label>
        <locationX>441</locationX>
        <locationY>495</locationY>
        <assignmentItems>
            <assignToReference>vSendToEmails</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>fEmailAddresses</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Get_Case_Team_Members</targetReference>
        </connector>
    </assignments>
    <constants>
        <name>IT</name>
        <dataType>String</dataType>
        <value>
            <stringValue>it@gwisupport.net</stringValue>
        </value>
    </constants>
    <constants>
        <name>SoftwareDevelopment</name>
        <dataType>String</dataType>
        <value>
            <stringValue>sd@gwisupport.net</stringValue>
        </value>
    </constants>
    <decisions>
        <name>Are_there_Team_Members</name>
        <label>Are there Team Members?</label>
        <locationX>272</locationX>
        <locationY>662</locationY>
        <defaultConnector>
            <targetReference>For_Each_Team_Member_0</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>[Default Outcome]</defaultConnectorLabel>
        <rules>
            <name>NO1</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>colCaseTeamMember</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <label>NO</label>
        </rules>
    </decisions>
    <decisions>
        <name>Owner_Comment</name>
        <label>Owner Comment?</label>
        <locationX>274</locationX>
        <locationY>493</locationY>
        <defaultConnectorLabel>[Default Outcome]</defaultConnectorLabel>
        <rules>
            <name>YES</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>ObjCase2.OwnerId</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <elementReference>objTask.CreatedById</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Get_Case_Team_Members_0</targetReference>
            </connector>
            <label>YES</label>
        </rules>
        <rules>
            <name>NO</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>ObjCase2.OwnerId</leftValueReference>
                <operator>NotEqualTo</operator>
                <rightValue>
                    <elementReference>objTask.CreatedById</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Send_To_Email_Addresses</targetReference>
            </connector>
            <label>NO</label>
        </rules>
    </decisions>
    <description>This flow sends email notification to the case owner when an activity has been added their case.</description>
    <formulas>
        <name>fcasethread</name>
        <dataType>String</dataType>
        <expression>&quot;ref:_&quot; &amp; LEFT({!$Organization.Id},5) &amp; SUBSTITUTE(RIGHT({!$Organization.Id},11), &quot;0&quot;, &quot;&quot; )&amp; &quot;._&quot; &amp; LEFT({!vCaseId1},5) &amp; SUBSTITUTE(Left(RIGHT({!vCaseId1},10), 5), &quot;0&quot;, &quot;&quot;) &amp; RIGHT({!vCaseId1},5) &amp; &quot;:ref&quot;</expression>
    </formulas>
    <formulas>
        <name>fEmailAddresses</name>
        <dataType>String</dataType>
        <expression>{!objUser.Email}</expression>
    </formulas>
    <formulas>
        <name>fNewEmail</name>
        <dataType>String</dataType>
        <expression>&quot;,&quot; &amp; {!vCTMemail}</expression>
    </formulas>
    <formulas>
        <name>fNewEmail1</name>
        <dataType>String</dataType>
        <expression>{!vCTMemail} &amp; &quot;,&quot;</expression>
    </formulas>
    <formulas>
        <name>fSenderAddress</name>
        <dataType>String</dataType>
        <expression>CASE({!objCaseRecordType.Name}, 
&quot;IT&quot;, &quot;it@gwisupport.net&quot;,
&quot;Support Work Order&quot;, &quot;salesforce-admins-group@staff.gwi.net&quot;,
&quot;Software Development&quot;, &quot;sd@gwisupport.net&quot;, 
&quot;Support Trouble&quot;, &quot;help@gwisupport.net&quot;, 
&quot;NE - Request&quot;, &quot;ne@gwisupport.net&quot;,
&quot;NE - Maintenance&quot;, &quot;ne2@gwisupport.net&quot;,
&quot;NE - Outage&quot;, &quot;ne1@gwisupport.net&quot;, &quot;&quot;)</expression>
    </formulas>
    <interviewLabel>Case Activity - Send Notification to Owner {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Case Activity - Send Notification to Owner</label>
    <loops>
        <name>For_Each_Team_Member</name>
        <label>For Each Team Member</label>
        <locationX>725</locationX>
        <locationY>494</locationY>
        <assignNextValueToReference>objCaseTeamMember</assignNextValueToReference>
        <collectionReference>colCaseTeamMember</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Get_Member_Record</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Send_email_Support</targetReference>
        </noMoreValuesConnector>
    </loops>
    <loops>
        <name>For_Each_Team_Member_0</name>
        <label>For Each Team Member</label>
        <locationX>271</locationX>
        <locationY>770</locationY>
        <assignNextValueToReference>objCaseTeamMember</assignNextValueToReference>
        <collectionReference>colCaseTeamMember</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Get_Member_Record_0</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Send_email_Support_0</targetReference>
        </noMoreValuesConnector>
    </loops>
    <processType>AutoLaunchedFlow</processType>
    <recordLookups>
        <name>Get_Activity_User_Name</name>
        <label>Get Activity User Name</label>
        <locationX>242</locationX>
        <locationY>348</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Get_Record_Types</targetReference>
        </connector>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>objTask.CreatedById</elementReference>
            </value>
        </filters>
        <object>User</object>
        <outputReference>objTaskUser</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>Name</queriedFields>
    </recordLookups>
    <recordLookups>
        <name>Get_Case_IDs</name>
        <label>Get Case IDs</label>
        <locationX>89</locationX>
        <locationY>135</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Get_Task_ID</targetReference>
        </connector>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>vCaseId1</elementReference>
            </value>
        </filters>
        <object>Case</object>
        <outputReference>ObjCase2</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>Status</queriedFields>
        <queriedFields>RecordTypeId</queriedFields>
        <queriedFields>Work_Order_Queue__c</queriedFields>
        <queriedFields>ContactId</queriedFields>
        <queriedFields>OwnerId</queriedFields>
        <queriedFields>CaseNumber</queriedFields>
        <queriedFields>Subject</queriedFields>
    </recordLookups>
    <recordLookups>
        <name>Get_Case_Team_Members</name>
        <label>Get Case Team Members</label>
        <locationX>575</locationX>
        <locationY>494</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>For_Each_Team_Member</targetReference>
        </connector>
        <filters>
            <field>ParentId</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>vCaseId1</elementReference>
            </value>
        </filters>
        <object>CaseTeamMember</object>
        <outputReference>colCaseTeamMember</outputReference>
        <queriedFields>MemberId</queriedFields>
    </recordLookups>
    <recordLookups>
        <name>Get_Case_Team_Members_0</name>
        <label>Get Case Team Members</label>
        <locationX>272</locationX>
        <locationY>583</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Are_there_Team_Members</targetReference>
        </connector>
        <filters>
            <field>ParentId</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>vCaseId1</elementReference>
            </value>
        </filters>
        <object>CaseTeamMember</object>
        <outputReference>colCaseTeamMember</outputReference>
        <queriedFields>MemberId</queriedFields>
    </recordLookups>
    <recordLookups>
        <name>Get_Member_Record</name>
        <label>Get Member Record</label>
        <locationX>646</locationX>
        <locationY>613</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Append_Email_Address</targetReference>
        </connector>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>objCaseTeamMember.MemberId</elementReference>
            </value>
        </filters>
        <object>User</object>
        <outputAssignments>
            <assignToReference>vCTMemail</assignToReference>
            <field>Email</field>
        </outputAssignments>
    </recordLookups>
    <recordLookups>
        <name>Get_Member_Record_0</name>
        <label>Get Member Record</label>
        <locationX>182</locationX>
        <locationY>928</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Append_Email_Address_0</targetReference>
        </connector>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>objCaseTeamMember.MemberId</elementReference>
            </value>
        </filters>
        <object>User</object>
        <outputAssignments>
            <assignToReference>vCTMemail</assignToReference>
            <field>Email</field>
        </outputAssignments>
    </recordLookups>
    <recordLookups>
        <name>Get_Record_Types</name>
        <label>Get Record Types</label>
        <locationX>85</locationX>
        <locationY>476</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Owner_Comment</targetReference>
        </connector>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>vRecordTypeID</elementReference>
            </value>
        </filters>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>ObjCase2.RecordTypeId</elementReference>
            </value>
        </filters>
        <object>RecordType</object>
        <outputReference>objCaseRecordType</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>Name</queriedFields>
    </recordLookups>
    <recordLookups>
        <name>Get_Task_ID</name>
        <label>Get Task ID</label>
        <locationX>97</locationX>
        <locationY>237</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Get_User_Email</targetReference>
        </connector>
        <filters>
            <field>WhatId</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>vCaseId1</elementReference>
            </value>
        </filters>
        <object>Task</object>
        <outputReference>objTask</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>Description</queriedFields>
        <queriedFields>CreatedById</queriedFields>
        <queriedFields>WhatId</queriedFields>
        <queriedFields>Subject</queriedFields>
        <queriedFields>CreatedDate</queriedFields>
        <sortField>CreatedDate</sortField>
        <sortOrder>Desc</sortOrder>
    </recordLookups>
    <recordLookups>
        <name>Get_User_Email</name>
        <label>Get User Email</label>
        <locationX>96</locationX>
        <locationY>346</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Get_Activity_User_Name</targetReference>
        </connector>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>ObjCase2.OwnerId</elementReference>
            </value>
        </filters>
        <object>User</object>
        <outputReference>objUser</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>Email</queriedFields>
        <queriedFields>Name</queriedFields>
    </recordLookups>
    <startElementReference>Get_Case_IDs</startElementReference>
    <status>Active</status>
    <textTemplates>
        <name>ttBody</name>
        <text>A new activity has been logged on Case#{!ObjCase2.CaseNumber} - {!ObjCase2.Subject}.

https://gwi.my.salesforce.com/{!vCaseId1}

See the activity details below:
--------------------------------------------------------------------------------------------------

{!objTask.Subject} - {!objTask.CreatedDate} Created By: {!objTaskUser.Name}

{!objTask.Description}

{!fcasethread}</text>
    </textTemplates>
    <textTemplates>
        <name>ttSubject</name>
        <text>New Case Activity Recorded Notification. Case Number 
{!ObjCase2.CaseNumber}</text>
    </textTemplates>
    <variables>
        <name>colCaseTeamMember</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <objectType>CaseTeamMember</objectType>
    </variables>
    <variables>
        <name>ObjCase2</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <objectType>Case</objectType>
    </variables>
    <variables>
        <name>ObjCaseComment</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>CaseComment</objectType>
    </variables>
    <variables>
        <name>objCaseRecordType</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <objectType>RecordType</objectType>
    </variables>
    <variables>
        <name>objCaseTeamMember</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <objectType>CaseTeamMember</objectType>
    </variables>
    <variables>
        <name>ObjEmailMessage</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <objectType>EmailMessage</objectType>
    </variables>
    <variables>
        <name>objEmailRelation</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <objectType>EmailMessageRelation</objectType>
    </variables>
    <variables>
        <name>objTask</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <objectType>Task</objectType>
    </variables>
    <variables>
        <name>objTaskUser</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <objectType>User</objectType>
    </variables>
    <variables>
        <name>objUser</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <objectType>User</objectType>
    </variables>
    <variables>
        <name>vActivityUser</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <name>vCaseComment1</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <name>vCaseId1</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <name>vCreatedById</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <name>vCTMemail</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <name>vEmailId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <name>vFieldQueue</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <name>vNSEQueue</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <name>vOwnerId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <name>VQueueId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <name>vRecordTypeID</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <name>vRecTypeID</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <name>vSendToEmails</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <name>vSupportQueue</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <name>vTaskId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <name>vtest</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
</Flow>

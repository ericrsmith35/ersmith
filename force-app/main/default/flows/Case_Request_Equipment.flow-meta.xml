<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <assignments>
        <name>Do_Nothing</name>
        <label>Do Nothing</label>
        <locationX>15</locationX>
        <locationY>8</locationY>
        <assignmentItems>
            <assignToReference>vOppID</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>0060e00001rNFf4</stringValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Get_Opportunity</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Set_Case_Fields</name>
        <label>Set Case Fields</label>
        <locationX>503</locationX>
        <locationY>646</locationY>
        <assignmentItems>
            <assignToReference>objCase.RecordTypeId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>vRecTypeID</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>objCase.Description</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Description</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>objCase.Opportunity__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>vOppID</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>objCase.Origin</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>Agent</stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>objCase.Status</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>New</stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>objCase.Subject</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Subject</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>objCase.AccountId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>vSA_Account</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>objCase.Service_Address__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>vServAddrID</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>objCase.ContactId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>objOpp.WFR_Delivery_Contact__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>objCase.OwnerId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>vQueueID</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>objCase.Service_Catagory__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>Equipment Request</stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>objCase.Provision_Date_Request__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Due_Date</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>objCase.Work_Order_Queue__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Department</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Save_Case</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Set_ID</name>
        <label>Set IDs</label>
        <locationX>320</locationX>
        <locationY>596</locationY>
        <assignmentItems>
            <assignToReference>vQueueID</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>vNSEQueue</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Set_Case_Fields</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Set_ID_0</name>
        <label>Set IDs</label>
        <locationX>320</locationX>
        <locationY>482</locationY>
        <assignmentItems>
            <assignToReference>vQueueID</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>vSupportQueue</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Set_Case_Fields</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Set_ID_1</name>
        <label>Set IDs</label>
        <locationX>318</locationX>
        <locationY>698</locationY>
        <assignmentItems>
            <assignToReference>vQueueID</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>vFieldQueue</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Set_Case_Fields</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Set_ID_1_1</name>
        <label>Set IDs</label>
        <locationX>316</locationX>
        <locationY>807</locationY>
        <assignmentItems>
            <assignToReference>vQueueID</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>fSelf</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Set_Case_Fields</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Set_Service_Address_ID</name>
        <label>Set Service Address ID</label>
        <locationX>317</locationX>
        <locationY>346</locationY>
        <assignmentItems>
            <assignToReference>vServAddrID</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>objOpp.Primary_Service_Address__c</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Get_Service_Address_Account</targetReference>
        </connector>
    </assignments>
    <choices>
        <name>Field</name>
        <choiceText>Field</choiceText>
        <dataType>String</dataType>
        <value>
            <stringValue>Field</stringValue>
        </value>
    </choices>
    <choices>
        <name>Hold_Assign_Case_to_Self</name>
        <choiceText>Hold (Assign Case to Self)</choiceText>
        <dataType>String</dataType>
        <value>
            <stringValue>Hold</stringValue>
        </value>
    </choices>
    <choices>
        <name>NSE</name>
        <choiceText>NSE</choiceText>
        <dataType>String</dataType>
        <value>
            <stringValue>NSE</stringValue>
        </value>
    </choices>
    <choices>
        <name>Primary</name>
        <choiceText>&lt;Primary Service Address&gt;</choiceText>
        <dataType>String</dataType>
        <value>
            <elementReference>objOpp.Primary_Service_Address__c</elementReference>
        </value>
    </choices>
    <choices>
        <name>Support</name>
        <choiceText>Support</choiceText>
        <dataType>String</dataType>
        <value>
            <stringValue>Support</stringValue>
        </value>
    </choices>
    <decisions>
        <name>Queue_Name</name>
        <label>Queue Name</label>
        <locationX>147</locationX>
        <locationY>641</locationY>
        <defaultConnectorLabel>[Default Outcome]</defaultConnectorLabel>
        <rules>
            <name>SUPPORT1</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Department</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <elementReference>Support</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Set_ID_0</targetReference>
            </connector>
            <label>SUPPORT</label>
        </rules>
        <rules>
            <name>NSE1</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Department</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <elementReference>NSE</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Set_ID</targetReference>
            </connector>
            <label>NSE</label>
        </rules>
        <rules>
            <name>FIELD1</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Department</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <elementReference>Field</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Set_ID_1</targetReference>
            </connector>
            <label>FIELD</label>
        </rules>
        <rules>
            <name>SELF</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Department</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <elementReference>Hold_Assign_Case_to_Self</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Set_ID_1_1</targetReference>
            </connector>
            <label>SELF</label>
        </rules>
    </decisions>
    <decisions>
        <name>Use_Primary_Service_Address_1</name>
        <label>Use Primary Service Address?</label>
        <locationX>148</locationX>
        <locationY>346</locationY>
        <defaultConnector>
            <targetReference>Get_Service_Address_Account</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>NO</defaultConnectorLabel>
        <rules>
            <name>YES</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Use_Primary_Service_Address</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Set_Service_Address_ID</targetReference>
            </connector>
            <label>YES</label>
        </rules>
    </decisions>
    <description>Create a Case in the selected queue for Assets to be created for the Opportunity.
5/14/18 - ers - Added Service Address selection
10/24/18 - ers - Change Service Address selection to Lightning Lookup Component</description>
    <dynamicChoiceSets>
        <name>ServiceAddresses</name>
        <dataType>String</dataType>
        <displayField>vwf_AcctNameDesc__c</displayField>
        <filters>
            <field>Top_Account__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>objOpp.Top_Account__c</elementReference>
            </value>
        </filters>
        <object>Service_Address__c</object>
        <sortField>vwf_AcctNameDescSorted__c</sortField>
        <sortOrder>Asc</sortOrder>
        <valueField>Id</valueField>
    </dynamicChoiceSets>
    <formulas>
        <name>fSelf</name>
        <dataType>String</dataType>
        <expression>{!$User.Id}</expression>
    </formulas>
    <interviewLabel>Case - Request Equipment {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Case - Request Equipment</label>
    <processType>Flow</processType>
    <recordCreates>
        <name>Save_Case</name>
        <label>Save Case</label>
        <locationX>674</locationX>
        <locationY>647</locationY>
        <inputReference>objCase</inputReference>
    </recordCreates>
    <recordLookups>
        <name>Get_Opportunity</name>
        <label>Get Opportunity</label>
        <locationX>145</locationX>
        <locationY>105</locationY>
        <assignNullValuesIfNoRecordsFound>true</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Get_Queue_IDs</targetReference>
        </connector>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>vOppID</elementReference>
            </value>
        </filters>
        <object>Opportunity</object>
        <outputReference>objOpp</outputReference>
        <queriedFields>AccountId</queriedFields>
        <queriedFields>Name</queriedFields>
        <queriedFields>Type</queriedFields>
        <queriedFields>WFR_Delivery_Contact__c</queriedFields>
        <queriedFields>Primary_Service_Address__c</queriedFields>
        <queriedFields>Primary_Dlvr_To_Acct__c</queriedFields>
        <queriedFields>Top_Account__c</queriedFields>
    </recordLookups>
    <recordLookups>
        <name>Get_Queue_IDs</name>
        <label>Get Queue IDs</label>
        <locationX>319</locationX>
        <locationY>104</locationY>
        <assignNullValuesIfNoRecordsFound>true</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Get_Service_Address_Name</targetReference>
        </connector>
        <filters>
            <field>DeveloperName</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Master</stringValue>
            </value>
        </filters>
        <object>Record_IDs__mdt</object>
        <outputAssignments>
            <assignToReference>vFieldQueue</assignToReference>
            <field>Case_Field_Work_Order_Queue__c</field>
        </outputAssignments>
        <outputAssignments>
            <assignToReference>vNSEQueue</assignToReference>
            <field>Case_NSE_Work_Order_Queue__c</field>
        </outputAssignments>
        <outputAssignments>
            <assignToReference>vSupportQueue</assignToReference>
            <field>Case_Support_Work_Order_Queue__c</field>
        </outputAssignments>
        <outputAssignments>
            <assignToReference>vRecTypeID</assignToReference>
            <field>Case_Support_Work_Order_Record_Type__c</field>
        </outputAssignments>
    </recordLookups>
    <recordLookups>
        <name>Get_Service_Address_Account</name>
        <label>Get Service Address Account</label>
        <locationX>147</locationX>
        <locationY>478</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Queue_Name</targetReference>
        </connector>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>vServAddrID</elementReference>
            </value>
        </filters>
        <object>Service_Address__c</object>
        <outputAssignments>
            <assignToReference>vSA_Account</assignToReference>
            <field>Account__c</field>
        </outputAssignments>
    </recordLookups>
    <recordLookups>
        <name>Get_Service_Address_Name</name>
        <label>Get Service Address Name</label>
        <locationX>320</locationX>
        <locationY>227</locationY>
        <assignNullValuesIfNoRecordsFound>true</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Equipment_Request</targetReference>
        </connector>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>objOpp.Primary_Service_Address__c</elementReference>
            </value>
        </filters>
        <object>Service_Address__c</object>
        <outputAssignments>
            <assignToReference>vServAddrName</assignToReference>
            <field>vwf_AcctNameDesc__c</field>
        </outputAssignments>
    </recordLookups>
    <screens>
        <name>Equipment_Request</name>
        <label>Equipment Request</label>
        <locationX>145</locationX>
        <locationY>225</locationY>
        <allowBack>true</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>true</allowPause>
        <connector>
            <targetReference>Use_Primary_Service_Address_1</targetReference>
        </connector>
        <fields>
            <name>Department</name>
            <choiceReferences>Support</choiceReferences>
            <choiceReferences>Field</choiceReferences>
            <choiceReferences>NSE</choiceReferences>
            <choiceReferences>Hold_Assign_Case_to_Self</choiceReferences>
            <dataType>String</dataType>
            <defaultSelectedChoiceReference>Support</defaultSelectedChoiceReference>
            <fieldText>Department</fieldText>
            <fieldType>RadioButtons</fieldType>
            <isRequired>true</isRequired>
        </fields>
        <fields>
            <name>Subject</name>
            <dataType>String</dataType>
            <defaultValue>
                <elementReference>ttCaseSubject</elementReference>
            </defaultValue>
            <fieldText>Subject</fieldText>
            <fieldType>InputField</fieldType>
            <isRequired>true</isRequired>
        </fields>
        <fields>
            <name>ServiceAddressLC</name>
            <extensionName>c:lookupFSC</extensionName>
            <fieldType>ComponentInstance</fieldType>
            <inputParameters>
                <name>objectName</name>
                <value>
                    <stringValue>Service_Address__c</stringValue>
                </value>
            </inputParameters>
            <inputParameters>
                <name>displayFieldName</name>
                <value>
                    <stringValue>vwf_AcctNameDesc__c</stringValue>
                </value>
            </inputParameters>
            <inputParameters>
                <name>label</name>
                <value>
                    <stringValue>Service Address</stringValue>
                </value>
            </inputParameters>
            <inputParameters>
                <name>valueFieldName</name>
                <value>
                    <stringValue>Id</stringValue>
                </value>
            </inputParameters>
            <inputParameters>
                <name>filterFieldName</name>
                <value>
                    <stringValue>Top_Account__c</stringValue>
                </value>
            </inputParameters>
            <inputParameters>
                <name>filterFieldValue</name>
                <value>
                    <elementReference>objOpp.Top_Account__c</elementReference>
                </value>
            </inputParameters>
            <isRequired>true</isRequired>
            <outputParameters>
                <assignToReference>vServAddrID</assignToReference>
                <name>selectedValue</name>
            </outputParameters>
        </fields>
        <fields>
            <name>Use_Primary_Service_Address</name>
            <dataType>Boolean</dataType>
            <fieldText>&lt;DIV ALIGN=&quot;LEFT&quot;&gt;&lt;FONT FACE=&quot;Arial&quot; STYLE=&quot;font-size:12px&quot; COLOR=&quot;#000000&quot; LETTERSPACING=&quot;0&quot; KERNING=&quot;0&quot;&gt;Use Opportunity&amp;apos;s Primary Service Address?&lt;/FONT&gt;&lt;/DIV&gt;&lt;DIV ALIGN=&quot;LEFT&quot;&gt;&lt;FONT FACE=&quot;Arial&quot; STYLE=&quot;font-size:12px&quot; COLOR=&quot;#000000&quot; LETTERSPACING=&quot;0&quot; KERNING=&quot;0&quot;&gt;{!vServAddrName}&lt;/FONT&gt;&lt;/DIV&gt;</fieldText>
            <fieldType>InputField</fieldType>
            <isRequired>true</isRequired>
        </fields>
        <fields>
            <name>Due_Date</name>
            <dataType>Date</dataType>
            <fieldText>Due Date</fieldText>
            <fieldType>InputField</fieldType>
            <isRequired>true</isRequired>
        </fields>
        <fields>
            <name>Description</name>
            <fieldText>Description</fieldText>
            <fieldType>LargeTextArea</fieldType>
            <isRequired>true</isRequired>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <startElementReference>Get_Opportunity</startElementReference>
    <status>Active</status>
    <textTemplates>
        <name>ttCaseSubject</name>
        <text>Turn-Up Ticket to {!Department} for: {!objOpp.Name}</text>
    </textTemplates>
    <variables>
        <name>colRecType</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>RecordType</objectType>
    </variables>
    <variables>
        <name>objCase</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Case</objectType>
    </variables>
    <variables>
        <name>objOpp</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Opportunity</objectType>
    </variables>
    <variables>
        <name>objRecType</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>RecordType</objectType>
    </variables>
    <variables>
        <name>vFieldQueue</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>vNSEQueue</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>vOppID</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>vQueueID</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>vRecTypeID</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>vSA_Account</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>vServAddrID</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>vServAddrName</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>vSupportQueue</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
</Flow>
